{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}
{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
<style>
/* Hero Slideshow */
.hero-slideshow {
  position: relative;
  height: 450px;
  margin-bottom: 3rem;
  border-radius: 16px;
  overflow: hidden;
  box-shadow: 0 10px 30px rgba(0,0,0,0.2);
}

.hero-slide {
  position: absolute;
  width: 100%;
  height: 100%;
  opacity: 0;
  transition: opacity 1.5s ease-in-out;
  background-size: cover;
  background-position: center;
}

.hero-slide.active {
  opacity: 1;
}

.hero-slide::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.4));
}

.hero-content {
  position: relative;
  z-index: 2;
  color: white;
  padding: 4rem 2rem;
  text-align: center;
  height: 100%;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}

.hero-content h1 {
  font-size: 3.5rem;
  font-weight: 800;
  text-shadow: 3px 3px 6px rgba(0,0,0,0.4);
  margin-bottom: 1.5rem;
  animation: fadeInUp 1s ease-out;
}

.hero-content p {
  font-size: 1.4rem;
  text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
  margin-bottom: 2rem;
  max-width: 700px;
  animation: fadeInUp 1.2s ease-out;
}

.hero-cta {
  display: flex;
  gap: 1rem;
  justify-content: center;
  flex-wrap: wrap;
  animation: fadeInUp 1.4s ease-out;
}

.hero-cta .btn {
  padding: 0.8rem 2rem;
  font-size: 1.1rem;
  font-weight: 600;
  border-radius: 50px;
  transition: all 0.3s ease;
}

.hero-cta .btn:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 20px rgba(0,0,0,0.3);
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Stats Cards */
.stats-card {
  border-radius: 16px;
  transition: all 0.3s ease;
  border: none;
  overflow: hidden;
}

.stats-card:hover {
  transform: translateY(-8px);
  box-shadow: 0 12px 24px rgba(0,0,0,0.15);
}

.stats-card .card-body {
  padding: 2rem;
  position: relative;
}

.stats-icon {
  font-size: 3rem;
  opacity: 0.9;
  margin-bottom: 1rem;
}

.stats-card h5 {
  font-weight: 700;
  margin-bottom: 0.5rem;
  font-size: 1.1rem;
}

.stats-card .card-text {
  color: #666;
  margin-bottom: 1.5rem;
}

.stats-card ul {
  font-size: 0.9rem;
  color: #555;
}

.stats-card .btn {
  border-radius: 50px;
  font-weight: 600;
  width: 100%;
}

/* Color variants */
.card-variant-1 { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
.card-variant-2 { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; }
.card-variant-3 { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; }
.card-variant-4 { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); color: white; }
.card-variant-5 { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); color: white; }
.card-variant-6 { background: linear-gradient(135deg, #30cfd0 0%, #330867 100%); color: white; }

.card-variant-1 .card-text,
.card-variant-2 .card-text,
.card-variant-3 .card-text,
.card-variant-4 .card-text,
.card-variant-5 .card-text,
.card-variant-6 .card-text { color: rgba(255,255,255,0.9); }

.card-variant-1 ul,
.card-variant-2 ul,
.card-variant-3 ul,
.card-variant-4 ul,
.card-variant-5 ul,
.card-variant-6 ul { color: rgba(255,255,255,0.95); }
</style>
{% endblock %}

{% block content %}
<!-- Hero Slideshow Section -->
<div class="hero-slideshow">
  <div class="hero-slide active" style="background-image: url('{{ url_for('static', filename='images/Backgrounds/pexels-nc-farm-bureau-mark-2255920.jpg') }}');">
    <div class="hero-content">
      <h1><i class="fas fa-seedling me-3"></i>AgriFarma</h1>
      <p>Empowering Farmers with Digital Solutions for Modern Agriculture</p>
      <div class="hero-cta">
        <a href="{{ url_for('marketplace.index') }}" class="btn btn-light btn-lg">
          <i class="fas fa-shopping-cart me-2"></i>Browse Marketplace
        </a>
        <a href="{{ url_for('consultancy.consultants') }}" class="btn btn-outline-light btn-lg">
          <i class="fas fa-user-md me-2"></i>Find Experts
        </a>
      </div>
    </div>
  </div>
  <div class="hero-slide" style="background-image: url('{{ url_for('static', filename='images/Backgrounds/pexels-ironic-751096.jpg') }}');">
    <div class="hero-content">
      <h1><i class="fas fa-users me-3"></i>Connect & Learn</h1>
      <p>Join thousands of farmers sharing knowledge and best practices</p>
      <div class="hero-cta">
        <a href="{{ url_for('forum.index') }}" class="btn btn-light btn-lg">
          <i class="fas fa-comments me-2"></i>Discussion Forum
        </a>
        <a href="{{ url_for('blog.index') }}" class="btn btn-outline-light btn-lg">
          <i class="fas fa-book me-2"></i>Knowledge Base
        </a>
      </div>
    </div>
  </div>
  <div class="hero-slide" style="background-image: url('{{ url_for('static', filename='images/Backgrounds/pexels-quang-nguyen-vinh-222549-2131784.jpg') }}');">
    <div class="hero-content">
      <h1><i class="fas fa-chart-line me-3"></i>Grow Your Farm</h1>
      <p>Access expert consultancy, quality products, and farming insights</p>
      <div class="hero-cta">
        <a href="{{ url_for('auth.register') }}" class="btn btn-light btn-lg">
          <i class="fas fa-user-plus me-2"></i>Join Now
        </a>
        <a href="{{ url_for('main.about') }}" class="btn btn-outline-light btn-lg">
          <i class="fas fa-info-circle me-2"></i>Learn More
        </a>
      </div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row g-4">
  <!-- Forum Card -->
  <div class="col-md-6 col-lg-4 mb-4">
    <div class="card stats-card card-variant-1 shadow h-100">
      <div class="card-body d-flex flex-column">
        <div class="stats-icon">üí¨</div>
        <h5 class="card-title">Latest Forum Posts</h5>
        <p class="card-text">{{ total_threads }} active discussions</p>
        {% if latest_threads %}
        <ul class="list-unstyled small mb-3">
          {% for thread in latest_threads[:3] %}
          <li class="mb-2">
            <a href="{{ url_for('forum.thread_detail', thread_id=thread.id, slug=thread.slug) }}" class="text-white text-decoration-none">
              <i class="fas fa-angle-right me-1"></i>{{ thread.title }}
            </a>
          </li>
          {% endfor %}
        </ul>
        {% endif %}
        <a href="{{ url_for('forum.index') }}" class="btn btn-light btn-sm mt-auto">Go to Forum</a>
      </div>
    </div>
  </div>

  <!-- Consultants Card -->
  <div class="col-md-6 col-lg-4 mb-4">
    <div class="card stats-card card-variant-2 shadow h-100">
      <div class="card-body d-flex flex-column">
        <div class="stats-icon">üßë‚Äçüåæ</div>
        <h5 class="card-title">Recommended Consultants</h5>
        <p class="card-text">{{ total_consultants }} verified experts</p>
        {% if recommended_consultants %}
        <ul class="list-unstyled small mb-3">
          {% for consultant in recommended_consultants %}
          <li class="mb-2">
            <a href="{{ url_for('consultancy.consultant_detail', consultant_id=consultant.id) }}" class="text-white text-decoration-none">
              <i class="fas fa-angle-right me-1"></i>{{ consultant.user.name }} - {{ consultant.specialization }}
            </a>
          </li>
          {% endfor %}
        </ul>
        {% endif %}
        <a href="{{ url_for('consultancy.consultants') }}" class="btn btn-light btn-sm mt-auto">View Directory</a>
      </div>
    </div>
  </div>

  <!-- Marketplace Card -->
  {% if current_user.is_authenticated and current_user.role and current_user.role.name == 'farmer' %}
  <div class="col-md-6 col-lg-4 mb-4">
    <div class="card stats-card card-variant-3 shadow h-100">
      <div class="card-body d-flex flex-column">
        <div class="stats-icon">üõí</div>
        <h5 class="card-title">My Products</h5>
        <p class="card-text">{{ my_products|length }} active listings</p>
        {% if my_products %}
        <ul class="list-unstyled small mb-3">
          {% for product in my_products[:3] %}
          <li class="mb-2">
            <i class="fas fa-angle-right me-1"></i>{{ product.name }} - Rs. {{ product.price }}
          </li>
          {% endfor %}
        </ul>
        {% endif %}
        <a href="{{ url_for('marketplace.index') }}" class="btn btn-light btn-sm mt-auto">Go to Marketplace</a>
      </div>
    </div>
  </div>
  {% else %}
  <div class="col-md-6 col-lg-4 mb-4">
    <div class="card stats-card card-variant-3 shadow h-100">
      <div class="card-body d-flex flex-column">
        <div class="stats-icon">üõí</div>
        <h5 class="card-title">Marketplace</h5>
        <p class="card-text">{{ total_products }} products available</p>
        {% if featured_products %}
        <ul class="list-unstyled small mb-3">
          {% for product in featured_products[:3] %}
          <li class="mb-2">
            <i class="fas fa-angle-right me-1"></i>{{ product.name }} - Rs. {{ product.price }}
          </li>
          {% endfor %}
        </ul>
        {% endif %}
        <a href="{{ url_for('marketplace.index') }}" class="btn btn-light btn-sm mt-auto">Go to Marketplace</a>
      </div>
    </div>
  </div>
  {% endif %}

  <!-- Reports Card (Admin Role) -->
  {% if current_user.is_authenticated and current_user.role and current_user.role.name == 'admin' %}
  <div class="col-md-6 col-lg-4 mb-4">
    <div class="card stats-card card-variant-4 shadow h-100">
      <div class="card-body d-flex flex-column">
        <div class="stats-icon">üìà</div>
        <h5 class="card-title">Analytics & Reports</h5>
        <p class="card-text">Platform statistics and trends</p>
        <ul class="list-unstyled small mb-3">
          <li class="mb-2"><i class="fas fa-angle-right me-1"></i>Users: {{ admin_stats.total_users }} ({{ admin_stats.active_users }} active)</li>
          <li class="mb-2"><i class="fas fa-angle-right me-1"></i>Discussions: {{ admin_stats.total_threads }}</li>
          <li class="mb-2"><i class="fas fa-angle-right me-1"></i>Products: {{ admin_stats.total_products }}</li>
        </ul>
        <a href="{{ url_for('admin.reports') }}" class="btn btn-light btn-sm mt-auto">View Reports</a>
      </div>
    </div>
  </div>
  {% endif %}

  <!-- Knowledge Base Card -->
  <div class="col-md-6 col-lg-4 mb-4">
    <div class="card stats-card card-variant-5 shadow h-100">
      <div class="card-body d-flex flex-column">
        <div class="stats-icon">üìö</div>
        <h5 class="card-title">Knowledge Base</h5>
        <p class="card-text">{{ total_blogs }} published articles</p>
        {% if recent_blogs %}
        <ul class="list-unstyled small mb-3">
          {% for blog in recent_blogs %}
          <li class="mb-2">
            <a href="{{ url_for('blog.post_detail', post_id=blog.id, slug=blog.slug) }}" class="text-white text-decoration-none">
              <i class="fas fa-angle-right me-1"></i>{{ blog.title }}
            </a>
          </li>
          {% endfor %}
        </ul>
        {% endif %}
        <a href="{{ url_for('blog.index') }}" class="btn btn-light btn-sm mt-auto">Explore Knowledge</a>
      </div>
    </div>
  </div>

  <!-- FAQs Card -->
  <div class="col-md-6 col-lg-4 mb-4">
    <div class="card stats-card card-variant-6 shadow h-100">
      <div class="card-body d-flex flex-column">
        <div class="stats-icon">‚ùì</div>
        <h5 class="card-title">FAQs</h5>
        <p class="card-text">Common questions answered</p>
        <ul class="list-unstyled small mb-3">
          <li class="mb-2"><i class="fas fa-angle-right me-1"></i>How to register as a farmer?</li>
          <li class="mb-2"><i class="fas fa-angle-right me-1"></i>How to consult with experts?</li>
          <li class="mb-2"><i class="fas fa-angle-right me-1"></i>How to list products for sale?</li>
        </ul>
        <a href="{{ url_for('main.about') }}" class="btn btn-light btn-sm mt-auto">View All FAQs</a>
      </div>
    </div>
  </div>
</div>

<script>
// Hero Slideshow Auto-rotation
let currentSlide = 0;
const slides = document.querySelectorAll('.hero-slide');
const totalSlides = slides.length;

function showSlide(index) {
  slides.forEach((slide, i) => {
    if (i === index) {
      slide.classList.add('active');
    } else {
      slide.classList.remove('active');
    }
  });
}

function nextSlide() {
  currentSlide = (currentSlide + 1) % totalSlides;
  showSlide(currentSlide);
}

// Auto-advance every 5 seconds
setInterval(nextSlide, 5000);

// Optional: Add click handlers for manual navigation
slides.forEach((slide, index) => {
  slide.addEventListener('click', () => {
    currentSlide = index;
    showSlide(currentSlide);
  });
});
</script>

  <!-- About Card -->
  <div class="col-md-6 col-lg-4 mb-4">
    <div class="card stats-card card-variant-4 shadow h-100">
      <div class="card-body d-flex flex-column">
        <div class="stats-icon">‚ÑπÔ∏è</div>
        <h5 class="card-title">About AgriFarma</h5>
        <p class="card-text">Digital hub for farmers in Sindh</p>
        <p class="small mb-3">Connecting farmers with expert advice, quality products, and a supportive community.</p>
        <a href="{{ url_for('main.about') }}" class="btn btn-light btn-sm mt-auto">Learn More</a>
      </div>
    </div>
  </div>
</div>
{% endblock %}