{% extends "base.html" %}

{% block title %}My Products{% endblock %}

{% block extra_css %}
<style>
.products-hero {
  background: linear-gradient(135deg, rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.4)),
              url('{{ url_for('static', filename='images/Backgrounds/pexels-nc-farm-bureau-mark-2255920.jpg') }}');
  background-size: cover;
  background-position: center;
  padding: 3rem 0;
  margin-bottom: 2rem;
  border-radius: 16px;
  color: white;
  text-align: center;
  box-shadow: 0 10px 30px rgba(0,0,0,0.2);
}
.products-hero h1 {
  font-size: 2.5rem;
  font-weight: 800;
  text-shadow: 3px 3px 6px rgba(0,0,0,0.4);
}
.stats-card {
  border: none;
  border-radius: 12px;
  padding: 1.5rem;
  transition: all 0.3s ease;
}
.stats-card:hover {
  transform: translateY(-5px);
}
</style>
{% endblock %}

{% block content %}
<!-- Hero Section -->
<div class="products-hero">
  <div class="container">
    <h1><i class="fas fa-store me-3"></i>My Products</h1>
    <p>Manage your product listings and track sales</p>
  </div>
</div>

<div class="container mb-5">
  <!-- Stats Cards -->
  <div class="row g-4 mb-4">
    <div class="col-md-4">
      <div class="card stats-card shadow text-center" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
        <div class="card-body">
          <h2 class="mb-1">{{ total_products }}</h2>
          <p class="mb-0 opacity-90">Total Products</p>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card stats-card shadow text-center" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); color: white;">
        <div class="card-body">
          <h2 class="mb-1">{{ active_products }}</h2>
          <p class="mb-0 opacity-90">Active Listings</p>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card stats-card shadow text-center" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white;">
        <div class="card-body">
          <h2 class="mb-1">Rs. {{ '%.0f'|format(total_revenue) }}</h2>
          <p class="mb-0 opacity-90">Total Revenue</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h5 class="mb-0"><i class="fas fa-box me-2"></i>Your Products</h5>
    <a href="{{ url_for('marketplace.product_new') }}" class="btn btn-success">
      <i class="fas fa-plus-circle me-2"></i>Add New Product
    </a>
  </div>

  <!-- Products Table -->
  {% if products %}
  <div class="card shadow-sm mb-5">
    <div class="table-responsive">
      <table class="table table-hover mb-0">
        <thead class="table-light">
          <tr>
            <th>Product</th>
            <th>Category</th>
            <th>Price</th>
            <th>Stock</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for product in products %}
          <tr>
            <td>
              <div class="d-flex align-items-center">
                {% if product.image_url %}
                <img src="{{ product.image_url }}" alt="{{ product.name }}" 
                     class="rounded me-2" style="width: 40px; height: 40px; object-fit: cover;">
                {% endif %}
                <strong>{{ product.name }}</strong>
              </div>
            </td>
            <td>{{ product.category }}</td>
            <td>Rs. {{ '%.2f'|format(product.price) }}</td>
            <td>
              <span class="badge bg-{{ 'success' if product.stock_quantity > 10 else 'warning' if product.stock_quantity > 0 else 'danger' }}">
                {{ product.stock_quantity }}
              </span>
            </td>
            <td>
              <span class="badge bg-{{ 'success' if product.is_active else 'secondary' }}">
                {{ 'Active' if product.is_active else 'Inactive' }}
              </span>
            </td>
            <td>
              <a href="{{ url_for('marketplace.product', product_id=product.id) }}" 
                 class="btn btn-sm btn-outline-info" title="View">
                <i class="fas fa-eye"></i>
              </a>
              <a href="{{ url_for('marketplace.product_edit', product_id=product.id) }}" 
                 class="btn btn-sm btn-outline-primary" title="Edit">
                <i class="fas fa-edit"></i>
              </a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Recent Sales -->
  <h5 class="mb-3"><i class="fas fa-chart-line me-2"></i>Recent Sales</h5>
  {% if sold_orders %}
  <div class="card shadow-sm">
    <div class="table-responsive">
      <table class="table table-hover mb-0">
        <thead class="table-light">
          <tr>
            <th>Order #</th>
            <th>Date</th>
            <th>Customer</th>
            <th>Items</th>
            <th>Amount</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          {% for order in sold_orders %}
          <tr>
            <td>#{{ order.order_number }}</td>
            <td>{{ order.order_date.strftime('%b %d, %Y') if order.order_date else 'N/A' }}</td>
            <td>{{ order.customer.name if order.customer else 'Unknown' }}</td>
            <td>{{ order.get_item_count() }}</td>
            <td>Rs. {{ '%.2f'|format(order.total_amount) }}</td>
            <td>
              <span class="badge bg-{{ 'success' if order.status == 'delivered' else 'warning' }}">
                {{ order.status|title }}
              </span>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  {% else %}
  <div class="alert alert-info">No sales yet. Keep your products active and wait for customers!</div>
  {% endif %}

  {% else %}
  <div class="card shadow-sm">
    <div class="card-body text-center py-5">
      <i class="fas fa-box text-muted mb-3" style="font-size: 4rem; opacity: 0.3;"></i>
      <h4 class="mb-3">No products yet</h4>
      <p class="text-muted mb-4">Start selling by adding your first product!</p>
      <a href="{{ url_for('marketplace.product_new') }}" class="btn btn-success btn-lg">
        <i class="fas fa-plus-circle me-2"></i>Add Your First Product
      </a>
    </div>
  </div>
  {% endif %}
</div>
{% endblock %}
