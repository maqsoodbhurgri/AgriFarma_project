{% extends "base.html" %}
{% block title %}Admin Reports{% endblock %}
{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
{% endblock %}

{% block content %}
<h3>üìà Analytics & Reports</h3>

<!-- Summary Cards -->
<div class="row mb-4">
  <div class="col-md-3">
    <div class="card shadow-sm">
      <div class="card-body text-center">
        <h6 class="text-muted">Total Users</h6>
        <h2 class="text-success">{{ total_users }}</h2>
        <p class="small mb-0">{{ new_users }} new (30 days)</p>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card shadow-sm">
      <div class="card-body text-center">
        <h6 class="text-muted">Forum Activity</h6>
        <h2 class="text-success">{{ total_threads }}</h2>
        <p class="small mb-0">{{ total_replies }} replies</p>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card shadow-sm">
      <div class="card-body text-center">
        <h6 class="text-muted">Marketplace</h6>
        <h2 class="text-success">{{ total_products }}</h2>
        <p class="small mb-0">{{ total_orders }} orders</p>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card shadow-sm">
      <div class="card-body text-center">
        <h6 class="text-muted">Revenue</h6>
        <h2 class="text-success">Rs. {{ "{:,.0f}".format(total_revenue) }}</h2>
        <p class="small mb-0">{{ total_consultants }} consultants</p>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <!-- Top Selling Products -->
  <div class="col-md-6">
    <div class="card shadow-sm">
      <div class="card-body">
        <h5 class="card-title">üèÜ Top-Selling Products</h5>
        {% if top_products %}
        <div class="table-responsive">
          <table class="table table-sm">
            <thead>
              <tr>
                <th>Product</th>
                <th>Sold</th>
                <th>Revenue</th>
              </tr>
            </thead>
            <tbody>
              {% for product in top_products %}
              <tr>
                <td>{{ product.name }}</td>
                <td>{{ product.sold_count }}</td>
                <td>Rs. {{ "{:,.0f}".format(product.price * product.sold_count) }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
        <p class="text-muted">No sales data available.</p>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Low Inventory Alerts -->
  <div class="col-md-6">
    <div class="card shadow-sm">
      <div class="card-body">
        <h5 class="card-title">‚ö†Ô∏è Low Inventory Alerts</h5>
        {% if low_stock_products %}
        <ul class="list-group list-group-flush">
          {% for product in low_stock_products %}
          <li class="list-group-item d-flex justify-content-between align-items-center">
            {{ product.name }}
            <span class="badge bg-warning">{{ product.stock_quantity }} units</span>
          </li>
          {% endfor %}
        </ul>
        {% else %}
        <p class="text-muted">All products are well stocked.</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<div class="row mt-4">
  <!-- Category Breakdown -->
  <div class="col-md-12">
    <div class="card shadow-sm">
      <div class="card-body">
        <h5 class="card-title">üì¶ Category Performance</h5>
        {% if category_stats %}
        <div class="table-responsive">
          <table class="table table-striped">
            <thead>
              <tr>
                <th>Category</th>
                <th>Products</th>
                <th>Total Sold</th>
                <th>Stock Available</th>
              </tr>
            </thead>
            <tbody>
              {% for stat in category_stats %}
              <tr>
                <td>{{ stat[0] or 'Uncategorized' }}</td>
                <td>{{ stat[1] }}</td>
                <td>{{ stat[2] or 0 }}</td>
                <td>{{ stat[3] or 0 }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
        <p class="text-muted">No category data available.</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<!-- Optional: Charts using Chart.js -->
{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Chart placeholders - can be enhanced with real data from backend
  console.log('Charts can be added here with Chart.js library');
</script>
{% endblock %}
{% endblock %}