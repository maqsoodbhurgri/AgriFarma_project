{% extends "base.html" %}
{% block title %}{{ profile.user.name if profile.user else 'Consultant Profile' }}{% endblock %}
{% block extra_css %}<link rel="stylesheet" href="{{ url_for('static', filename='css/consultants.css') }}">{% endblock %}
{% block content %}
<div class="row g-4">
  <div class="col-12 col-lg-4">
    <div class="consultant-card text-center">
      {% if profile.user.profile_picture %}
      <img src="{{ url_for('static', filename=profile.user.profile_picture) }}" alt="{{ profile.user.name }} - Agricultural Consultant Profile Picture" class="img-fluid rounded-circle mb-3" style="max-width:160px;">
      {% else %}
      <img src="{{ url_for('static', filename='img/backgrounds/consultant-placeholder.jpg') }}" alt="Consultant profile - No photo available" class="img-fluid rounded-circle mb-3" style="max-width:160px;">
      {% endif %}
      <div class="consultant-name">{{ profile.user.name if profile.user else 'Consultant Name' }}</div>
      <div class="consultant-category">{{ profile.specialization or 'General Agriculture' }}</div>
      {% if profile.rating > 0 %}
      <div class="mt-2">⭐ {{ profile.rating }}/5.0 ({{ profile.total_sessions }} sessions)</div>
      {% endif %}
      {% if profile.hourly_rate %}
      <div class="mt-2 small text-muted">Rate: Rs. {{ profile.hourly_rate }}/hour</div>
      {% endif %}
      {% if profile.available_online %}
      <span class="badge bg-success mt-2">Available Online</span>
      {% endif %}
      {% if profile.is_verified %}
      <span class="badge bg-primary mt-2">✓ Verified</span>
      {% endif %}
    </div>
  </div>
  
  <div class="col-12 col-lg-8">
    <div class="consultant-card">
      <h5>About</h5>
      <p>{{ profile.bio or 'Bio and background of the consultant with focus areas and past projects.' }}</p>
      
      {% if profile.user %}
      <h6 class="mt-3">Contact Information</h6>
      <p class="small mb-1"><strong>Email:</strong> {{ profile.user.email }}</p>
      {% if profile.user.mobile %}
      <p class="small mb-1"><strong>Mobile:</strong> {{ profile.user.mobile }}</p>
      {% endif %}
      {% if profile.user.city %}
      <p class="small mb-1"><strong>Location:</strong> {{ profile.user.city }}, {{ profile.user.state or 'Sindh' }}</p>
      {% endif %}
      {% endif %}
      
      {% if slots %}
      <h6 class="mt-4">Available Time Slots</h6>
      <div class="list-group">
        {% for slot in slots %}
        <div class="list-group-item">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <strong>{{ slot.start_time.strftime('%b %d, %Y %I:%M %p') if slot.start_time else 'TBD' }}</strong>
              <p class="small mb-0 text-muted">Duration: {{ slot.duration_minutes() }} minutes | Price: Rs. {{ slot.price or profile.hourly_rate or 0 }}</p>
            </div>
            {% if current_user.is_authenticated %}
            <a href="{{ url_for('consultancy.book_slot', slot_id=slot.id) }}" class="btn btn-success btn-sm">Book</a>
            {% endif %}
          </div>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <p class="text-muted mt-3">No available slots at the moment.</p>
      {% endif %}
    </div>
    
    {% if current_user.is_authenticated and contact_form %}
    <div class="consultant-card mt-3">
      <h6>Send a Message</h6>
      <form method="POST" action="{{ url_for('consultancy.contact_consultant', consultant_id=profile.id) }}">
        {{ contact_form.hidden_tag() }}
        <div class="mb-2">
          {{ contact_form.subject(class="form-control form-control-sm", placeholder="Subject") }}
        </div>
        <div class="mb-2">
          {{ contact_form.message(class="form-control form-control-sm", rows="4", placeholder="Your message...") }}
        </div>
        <button type="submit" class="btn btn-success btn-sm">Send Message</button>
      </form>
    </div>
    {% elif not current_user.is_authenticated %}
    <div class="alert alert-info mt-3">
      <a href="{{ url_for('auth.login') }}">Login</a> to book consultations or send messages.
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}